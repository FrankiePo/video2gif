!function(e,t,r,i){"use strict";function n(){return h.isValid()}function o(){function e(e,t,r,i,n){var o,a,c,l,u,m,f;for(-1>(c=t-e)&&(c=-1),(l=t+e)>d&&(l=d),o=t+1,a=t-1,m=1;l>o||a>c;){if(u=x[m++],l>o){f=s[o++];try{f[0]-=u*(f[0]-r)/w|0,f[1]-=u*(f[1]-i)/w|0,f[2]-=u*(f[2]-n)/w|0}catch(e){}}if(a>c){f=s[a--];try{f[0]-=u*(f[0]-r)/w|0,f[1]-=u*(f[1]-i)/w|0,f[2]-=u*(f[2]-n)/w|0}catch(e){}}}}function t(e,t,r,i,n){var o=s[t],a=e/b;o[0]-=a*(o[0]-r)|0,o[1]-=a*(o[1]-i)|0,o[2]-=a*(o[2]-n)|0}function r(e,t,r){var i,n,o,a,c,m,v,b,w,y;for(w=b=~(1<<31),v=m=-1,i=0;d>i;i++)0>(n=(y=s[i])[0]-e)&&(n=-n),0>(o=y[1]-t)&&(o=-o),n+=o,0>(o=y[2]-r)&&(o=-o),b>(n+=o)&&(b=n,m=i),w>(a=n-(C[i]>>u-l))&&(w=a,v=i),S[i]-=c=S[i]>>g,C[i]+=c<<f;return S[m]+=h,C[m]-=p,v}var i,n,o,a,s,d=256,c=d-1,l=4,u=16,m=1<<u,f=10,g=10,h=m>>g,p=m<<f-g,v=64*(d>>3),b=1024,w=1<<18,y=[],C=[],S=[],x=[];return(function(e,t,r){var i,c;for(n=e,o=t,a=r,s=new Array(d),i=0;d>i;i++)s[i]=new Array(4),(c=s[i])[0]=c[1]=c[2]=(i<<l+8)/d|0,S[i]=m/d|0,C[i]=0}).apply(this,arguments),{map:function(e,t,r){var i,n,o,a,c,l,u;for(c=1e3,u=-1,n=(i=y[t])-1;d>i||n>=0;)d>i&&((o=(l=s[i])[1]-t)>=c?i=d:(i++,0>o&&(o=-o),0>(a=l[0]-e)&&(a=-a),c>(o+=a)&&(0>(a=l[2]-r)&&(a=-a),c>(o+=a)&&(c=o,u=l[3])))),n>=0&&((o=t-(l=s[n])[1])>=c?n=-1:(n--,0>o&&(o=-o),0>(a=l[0]-e)&&(a=-a),c>(o+=a)&&(0>(a=l[2]-r)&&(a=-a),c>(o+=a)&&(c=o,u=l[3]))));return u},process:function(){return function(){var s,d,c,u,m,f,g,h,p,w,y,C,S,k;for(1509>o&&(a=1),i=30+(a-1)/3,C=n,S=0,k=o,w=(y=o/(3*a))/100|0,h=b,1>=(g=(f=v)>>6)&&(g=0),s=0;g>s;s++)x[s]=h*(256*(g*g-s*s)/(g*g));for(p=1509>o?3:o%499!=0?1497:o%491!=0?1473:o%487!=0?1461:1509,s=0;y>s;)if(t(h,d=r(c=(255&C[S+0])<<l,u=(255&C[S+1])<<l,m=(255&C[S+2])<<l),c,u,m),0!==g&&e(g,d,c,u,m),(S+=p)>=k&&(S-=o),s++,0===w&&(w=1),s%w==0)for(h-=h/i,1>=(g=(f-=f/30)>>6)&&(g=0),d=0;g>d;d++)x[d]=h*(256*(g*g-d*d)/(g*g))}(),function(){var e;for(e=0;d>e;e++)s[e][0]>>=l,s[e][1]>>=l,s[e][2]>>=l,s[e][3]=e}(),function(){var e,t,r,i,n,o,a,l;for(a=0,l=0,e=0;d>e;e++){for(r=e,i=(n=s[e])[1],t=e+1;d>t;t++)(o=s[t])[1]<i&&(r=t,i=o[1]);if(o=s[r],e!=r&&(t=o[0],o[0]=n[0],n[0]=t,t=o[1],o[1]=n[1],n[1]=t,t=o[2],o[2]=n[2],n[2]=t,t=o[3],o[3]=n[3],n[3]=t),i!=a){for(y[a]=l+e>>1,t=a+1;i>t;t++)y[t]=e;a=i,l=e}}for(y[a]=l+c>>1,t=a+1;256>t;t++)y[t]=c}(),function(){for(var e=[],t=new Array(d),r=0;d>r;r++)t[s[r][3]]=r;for(var i=0,n=0;d>n;n++){var o=t[n];e[i++]=s[o][0],e[i++]=s[o][1],e[i++]=s[o][2]}return e}()}}}function a(){try{this.onmessage=function(t){var r,i=t.data||{};i.gifshot&&(r=e.run(i),postMessage(r))}}catch(e){}var e={dataToRGB:function(e,t,r){for(var i=t*r*4,n=0,o=[];i>n;)o.push(e[n++]),o.push(e[n++]),o.push(e[n++]),n++;return o},componentizedPaletteToArray:function(e){e=e||[];for(var t=[],r=0;r<e.length;r+=3)t.push(e[r]<<16|e[r+1]<<8|e[r+2]);return t},processFrameWithQuantizer:function(e,t,r,i){for(var n=this.dataToRGB(e,t,r),a=new o(n,n.length,i),s=a.process(),d=new Uint32Array(this.componentizedPaletteToArray(s)),c=t*r,l=new Uint8Array(c),u=0,m=0;c>m;m++){var f=n[u++],g=n[u++],h=n[u++];l[m]=a.map(f,g,h)}return{pixels:l,palette:d}},run:function(e){var t=e=e||{};return this.processFrameWithQuantizer(e.data,t.width,t.height,t.sampleInterval)}};return e}function s(){function e(){var e;f.each(c,function(e,t){t&&(t.text?m.addFrame(t.img,a,t.text):m.addFrame(t,a))}),e=n,m.getBase64GIF(function(t){e({error:!1,errorCode:"",errorMsg:"",image:t})})}var r=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=r.callback,o=r.images,a=r.options,s=r.imagesLength,d=h.validate({getUserMedia:!0,"window.URL":!0}),c=[],l=0,u=void 0,m=void 0;return d.error?n(d):(m=new C(a),void f.each(o,function(r,i){var o=i;i.src&&(o=o.src),f.isElement(o)?(a.crossOrigin&&(o.crossOrigin=a.crossOrigin),c[r]=o,(l+=1)===s&&e()):f.isString(o)&&(u=new Image,a.crossOrigin&&(u.crossOrigin=a.crossOrigin),function(t){i.text&&(t.text=i.text),t.onerror=function(){var e=void 0;return 0==--s?((e={}).error="None of the requested images was capable of being retrieved",n(e)):void 0},t.onload=function(){c[r]=i.text?{img:t,text:t.text}:t,(l+=1)===s&&e(),f.removeElement(t)},t.src=o}(u),f.setCSSAttr(u,{position:"fixed",opacity:"0"}),t.body.appendChild(u))}))}function d(e){e=f.isObject(e)?e:{},k.stopVideoStreaming(e)}function c(e,r){var i=e.options||{},n=i.images,o=i.video,a=Number(i.gifWidth),s=Number(i.gifHeight),c=(Number(i.numFrames),e.cameraStream),l=e.videoElement,u=e.videoWidth,m=e.videoHeight,g=x.getCropDimensions({videoWidth:u,videoHeight:m,gifHeight:s,gifWidth:a}),h=r;i.crop=g,i.videoElement=l,i.videoWidth=u,i.videoHeight=m,i.cameraStream=c,f.isElement(l)&&(l.width=a+g.width,l.height=s+g.height,i.webcamVideoElement||(f.setCSSAttr(l,{position:"fixed",opacity:"0"}),t.body.appendChild(l)),l.play(),x.getGIF(i,function(e){n&&n.length||o&&o.length||d(e),h(e)}))}function l(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.callback,r=e.existingVideo,n=e.options,o=h.validate({getUserMedia:!0,"window.URL":!0}),a=void 0;if(o.error)return t(o);if(f.isElement(r)&&r.src){if(a=f.getExtension(r.src),!f.isSupported.videoCodecs[a])return t(h.messages.videoCodecs)}else f.isArray(r)&&f.each(r,function(e,t){return a=t instanceof Blob?t.type.substr(t.type.lastIndexOf("/")+1,t.length):t.substr(t.lastIndexOf(".")+1,t.length),f.isSupported.videoCodecs[a]?(r=t,!1):void 0});k.startStreaming({completed:function(e){e.options=n||{},c(e,t)},existingVideo:r,crossOrigin:n.crossOrigin,options:n})}function u(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.callback,r=e.lastCameraStream,o=e.options,a=e.webcamVideoElement;return n()?o.savedRenderingContexts.length?void x.getGIF(o,function(e){t(e)}):void k.startVideoStreaming(function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e.options=o||{},c(e,t)},{lastCameraStream:r,callback:t,webcamVideoElement:a,crossOrigin:o.crossOrigin}):t(h.validate())}function m(e,t){if(t=f.isFunction(e)?e:t,e=f.isObject(e)?e:{},f.isFunction(t)){var r=f.mergeOptions(b,e)||{},i=e.cameraStream,n=r.images,o=n?n.length:0,a=r.video,d=r.webcamVideoElement;r=f.mergeOptions(r,{gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),o?s({images:n,imagesLength:o,callback:t,options:r}):a?l({existingVideo:a,callback:t,options:r}):u({lastCameraStream:i,callback:t,webcamVideoElement:d,options:r})}}var f={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia;return e?e.bind(r):e}(),requestAnimFrame:e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame,requestTimeout:function(e,t){if(e=e||f.noop,t=t||0,!f.requestAnimFrame)return setTimeout(e,t);var r=(new Date).getTime(),i=new Object,n=f.requestAnimFrame;return i.value=n(function o(){(new Date).getTime()-r>=t?e.call():i.value=n(o)}),i},Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:function(){var t=e.btoa||function(e){for(var t="",r=0,i=e.length,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,a=void 0,s=void 0,d=void 0,c=void 0,l=void 0,u=void 0;i>r;)d=(o=e.charCodeAt(r++))>>2,c=(3&o)<<4|(a=e.charCodeAt(r++))>>4,l=(15&a)<<2|(s=e.charCodeAt(r++))>>6,u=63&s,isNaN(a)?l=u=64:isNaN(s)&&(u=64),t=t+n.charAt(d)+n.charAt(c)+n.charAt(l)+n.charAt(u);return t};return t?t.bind(e):f.noop}(),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return f.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=t.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return e.Worker},blob:function(){return f.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array},videoCodecs:function(){var e=t.createElement("video"),r={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(r.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),r.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),r.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),r.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),r.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(e){}return r}()},noop:function(){},each:function(e,t){var r=void 0,i=void 0;if(f.isArray(e))for(r=-1,i=e.length;++r<i&&!1!==t(r,e[r]););else if(f.isObject(e))for(r in e)if(e.hasOwnProperty(r)&&!1===t(r,e[r]))break},mergeOptions:function(e,t){if(f.isObject(e)&&f.isObject(t)&&Object.keys){var r={};return f.each(e,function(t){r[t]=e[t]}),f.each(t,function(i){var n=t[i];r[i]=f.isObject(n)&&e[i]?f.mergeOptions(e[i],n):n}),r}},setCSSAttr:function(e,t,r){f.isElement(e)&&(f.isString(t)&&f.isString(r)?e.style[t]=r:f.isObject(t)&&f.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){f.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!f.isString(e))return{};try{var t=new f.Blob([e],{type:"text/javascript"}),r=f.URL.createObjectURL(t);return{objectUrl:r,worker:new Worker(r)}}catch(e){return""+e}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};if(!t.body||!1===e.resizeFont)return e.fontSize;var r=e.text,n=e.gifWidth,o=parseInt(e.fontSize,10),a=parseInt(e.minFontSize,10),s=t.createElement("div"),d=t.createElement("span");for(s.setAttribute("width",n),s.appendChild(d),d.innerHTML=r,d.style.fontSize=o+"px",d.style.textIndent="-9999px",d.style.visibility="hidden",t.body.appendChild(d);d.offsetWidth>n&&o>=a;)d.style.fontSize=--o+"px";return t.body.removeChild(d),o+"px"},webWorkerError:!1},g=Object.freeze({default:f}),h={validate:function(e){e=f.isObject(e)?e:{};var t={};return f.each(h.validators,function(r,i){return e[i.errorCode]||i.condition?void 0:((t=i).error=!0,!1)}),delete t.condition,t},isValid:function(e){return!0!==h.validate(e).error},validators:[{condition:f.isFunction(f.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:f.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:f.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:f.isFunction(f.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:f.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:f.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:f.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},p=Object.freeze({default:h}),v=function(){},b={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:v,completeCallback:v,saveRenderingContexts:!1,savedRenderingContexts:[],crossOrigin:"Anonymous"},w=Object.freeze({default:b}),y=function(){},C=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=y,this.onRenderProgressCallback=y,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};C.prototype={workerMethods:a(),initializeWebWorkers:function(e){var r,i=o.toString()+"("+a.toString()+"());",n=void 0,s=void 0,d=-1,c="";for(r=e.numWorkers;++d<r;)n=f.createWebWorker(i),f.isObject(n)?(this.workers.push({worker:s=n.worker,objectUrl:n.objectUrl}),this.availableWorkers.push(s)):(c=n,f.webWorkerError=!!n);this.workerError=c,this.canvas=t.createElement("canvas"),this.canvas.width=e.gifWidth,this.canvas.height=e.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=this.byteMap[e[i]];return r},onFrameFinished:function(e){var t=this,r=t.frames,i=!!(t.options.images||[]).length,n=r.every(function(e){return!e.beingProcessed&&e.done});t.numRenderedFrames++,i&&e(t.numRenderedFrames/r.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/r.length),n?t.generatingGIF||t.generateGIF(r,t.onRenderCompleteCallback):f.requestTimeout(function(){t.processNextFrame()},1)},processFrame:function(e){var t=this,r=this.options,n=r.progressCallback,o=r.sampleInterval,a=void 0,s=void 0,d=function(){var e=(arguments.length>0&&arguments[0]!==i?arguments[0]:{}).data;delete a.data,a.pixels=Array.prototype.slice.call(e.pixels),a.palette=Array.prototype.slice.call(e.palette),a.done=!0,a.beingProcessed=!1,t.freeWorker(s),t.onFrameFinished(n)};return(a=this.frames[e]).beingProcessed||a.done?void this.onFrameFinished():(a.sampleInterval=o,a.beingProcessed=!0,a.gifshot=!0,void((s=this.getWorker())?(s.onmessage=d,s.postMessage(a)):d({data:t.workerMethods.run(a)})))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var r=this.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(e,t){var r=[],n=this.options,o=n.interval,a=n.frameDuration,s=!!n.images.length,d=n.gifHeight,c=n.gifWidth,l=new function(e,t,r,n){var o=0,a=(n=n===i?{}:n).loop===i?null:n.loop,s=n.palette===i?null:n.palette;if(0>=t||0>=r||t>65535||r>65535)throw"Width/Height invalid.";if(e[o++]=71,e[o++]=73,e[o++]=70,e[o++]=56,e[o++]=57,e[o++]=97,e[o++]=255&t,e[o++]=t>>8&255,e[o++]=255&r,e[o++]=r>>8&255,e[o++]=0|(null!==s?128:0),e[o++]=0,e[o++]=0,null!==a){if(0>a||a>65535)throw"Loop count invalid.";e[o++]=33,e[o++]=255,e[o++]=11,e[o++]=78,e[o++]=69,e[o++]=84,e[o++]=83,e[o++]=67,e[o++]=65,e[o++]=80,e[o++]=69,e[o++]=50,e[o++]=46,e[o++]=48,e[o++]=3,e[o++]=1,e[o++]=255&a,e[o++]=a>>8&255,e[o++]=0}var d=!1;this.addFrame=function(t,r,n,a,c,l){if(!0===d&&(--o,d=!1),l=l===i?{}:l,0>t||0>r||t>65535||r>65535)throw"x/y invalid.";if(0>=n||0>=a||n>65535||a>65535)throw"Width/Height invalid.";if(c.length<n*a)throw"Not enough pixels for the frame size.";var u=!0,m=l.palette;if((m===i||null===m)&&(u=!1,m=s),m===i||null===m)throw"Must supply either a local or global palette.";for(var f=function(e){var t=m.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}(),g=0;f>>=1;)++g;f=1<<g;var h=l.delay===i?0:l.delay,p=l.disposal===i?0:l.disposal;if(0>p||p>3)throw"Disposal out of range.";var v=!1,b=0;if(l.transparent!==i&&null!==l.transparent&&(v=!0,0>(b=l.transparent)||b>=f))throw"Transparent color index.";if((0!==p||v||0!==h)&&(e[o++]=33,e[o++]=249,e[o++]=4,e[o++]=p<<2|(!0===v?1:0),e[o++]=255&h,e[o++]=h>>8&255,e[o++]=b,e[o++]=0),e[o++]=44,e[o++]=255&t,e[o++]=t>>8&255,e[o++]=255&r,e[o++]=r>>8&255,e[o++]=255&n,e[o++]=n>>8&255,e[o++]=255&a,e[o++]=a>>8&255,e[o++]=!0===u?128|g-1:0,!0===u)for(var w=0,y=m.length;y>w;++w){var C=m[w];e[o++]=C>>16&255,e[o++]=C>>8&255,e[o++]=255&C}o=function(e,t,r,n){function o(r){for(;f>=r;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){g|=e<<f,f+=m,o(8)}e[t++]=r;var s=t++,d=1<<r,c=d-1,l=d+1,u=l+1,m=r+1,f=0,g=0,h=n[0]&c,p={};a(d);for(var v=1,b=n.length;b>v;++v){var w=n[v]&c,y=h<<8|w,C=p[y];if(C===i){for(g|=h<<f,f+=m;f>=8;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++);4096===u?(a(d),u=l+1,m=r+1,p={}):(u>=1<<m&&++m,p[y]=u++),h=w}else h=C}return a(h),a(l),o(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}(e,o,2>g?2:g,c)},this.end=function(){return!1===d&&(e[o++]=59,d=!0),o}}(r,c,d,{loop:this.repeat}),u=this.onRenderProgressCallback,m=s?100*o:0,g=void 0;this.generatingGIF=!0,f.each(e,function(t,r){var i=r.palette;u(.75+.25*r.position*1/e.length);for(var n=0;a>n;n++)l.addFrame(0,0,c,d,r.pixels,{palette:i,delay:m})}),l.end(),u(1),this.frames=[],this.generatingGIF=!1,f.isFunction(t)&&(g=this.bufferToString(r),t("data:image/gif;base64,"+f.btoa(g)))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t){t=f.isObject(t)?t:{};var r=this,i=r.ctx,n=r.options,o=n.gifWidth,a=n.gifHeight,s=f.getFontSize(t),d=t.filter,c=t.fontColor,l=t.text,u=t.textAlign,m=t.textBaseline,g=t.textXCoordinate?t.textXCoordinate:"left"===u?1:"right"===u?o:o/2,h=t.textYCoordinate?t.textYCoordinate:"top"===m?1:"center"===m?a/2:a,p=t.fontWeight+" "+s+" "+t.fontFamily,v=void 0;try{i.filter=d,i.drawImage(e,0,0,o,a),l&&(i.font=p,i.fillStyle=c,i.textAlign=u,i.textBaseline=m,i.fillText(l,g,h)),v=i.getImageData(0,0,o,a),r.addFrameImageData(v)}catch(e){return""+e}},addFrameImageData:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};this.frames.push({data:e.data,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:this.frames.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this;t.startRendering(function(r){t.destroyWorkers(),f.requestTimeout(function(){e(r)},0)})},destroyWorkers:function(){this.workerError||f.each(this.workers,function(e,t){var r=t.objectUrl;t.worker.terminate(),f.URL.revokeObjectURL(r)})}};var S=function(){},x={getGIF:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=arguments[1];r=f.isFunction(r)?r:S;var n=t.createElement("canvas"),o=void 0,a=!!e.images.length,s=e.cameraStream,d=e.crop,c=e.filter,l=e.fontColor,u=e.fontFamily,m=e.fontWeight,g=e.keepCameraOn,h=e.progressCallback,p=e.saveRenderingContexts,v=e.savedRenderingContexts,b=e.text,w=e.textAlign,y=e.textBaseline,x=e.videoElement,k=e.videoHeight,F=e.videoWidth,O=e.webcamVideoElement,E=Number(e.gifWidth),W=Number(e.gifHeight),A=Number(e.interval),U=(Number(e.sampleInterval),a?0:1e3*A),R=[],M=v.length?v.length:e.numFrames,T=M,I=new C(e),j=f.getFontSize(e),V=e.textXCoordinate?e.textXCoordinate:"left"===w?1:"right"===w?E:E/2,z=e.textYCoordinate?e.textYCoordinate:"top"===y?1:"center"===y?W/2:W,L=m+" "+j+" "+u,H=d?Math.floor(d.scaledWidth/2):0,B=d?F-d.scaledWidth:0,P=d?Math.floor(d.scaledHeight/2):0,G=d?k-d.scaledHeight:0;M=M!==i?M:10,A=A!==i?A:.1,n.width=E,n.height=W,o=n.getContext("2d"),function e(){return v.length||0!==x.currentTime?void function e(){function t(){var t;p&&R.push(o.getImageData(0,0,E,W)),b&&(o.font=L,o.fillStyle=l,o.textAlign=w,o.textBaseline=y,o.fillText(b,V,z)),t=o.getImageData(0,0,E,W),I.addFrameImageData(t),h((M-(T=i))/M),i>0&&f.requestTimeout(e,U),T||I.getBase64GIF(function(e){r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:s,videoElement:x,webcamVideoElement:O,savedRenderingContexts:R,keepCameraOn:g})})}var i=T-1;v.length?(o.putImageData(v[M-T],0,0),t()):function e(){try{B>F&&(B=F),G>k&&(G=k),0>H&&(H=0),0>P&&(P=0),o.filter=c,o.drawImage(x,H,P,B,G,0,0,E,W),t()}catch(t){if("NS_ERROR_NOT_AVAILABLE"!==t.name)throw t;f.requestTimeout(e,100)}}()}():void f.requestTimeout(e,100)}()},getCropDimensions:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.videoWidth,r=e.videoHeight,n=e.gifWidth,o=e.gifHeight,a={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(a.width=Math.round(t*(o/r))-n,a.scaledWidth=Math.round(a.width*(r/o))):(a.height=Math.round(r*(n/t))-o,a.scaledHeight=Math.round(a.height*(t/n))),a}},k={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var r=t.cameraStream,i=t.completedCallback,n=t.videoElement;n&&(n.videoWidth>0&&n.videoHeight>0?(n.removeEventListener("loadeddata",k.findVideoSize),i({videoElement:n,cameraStream:r,videoWidth:n.videoWidth,videoHeight:n.videoHeight})):e.attempts<10?(e.attempts+=1,f.requestTimeout(function(){k.findVideoSize(t)},400)):i({videoElement:n,cameraStream:r,videoWidth:k.defaultVideoDimensions.width,videoHeight:k.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){f.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=f.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,r=e.cameraStream,i=e.completedCallback,n=e.streamedCallback,o=e.videoElement;if(f.isFunction(n)&&n(),t){if(f.isString(t))o.src=t,o.innerHTML='<source src="'+t+'" type="video/'+f.getExtension(t)+'" />';else if(t instanceof Blob){try{o.src=f.URL.createObjectURL(t)}catch(e){}o.innerHTML='<source src="'+t+'" type="'+t.type+'" />'}}else if(o.mozSrcObject)o.mozSrcObject=r;else if(f.URL)try{o.srcObject=r,o.src=f.URL.createObjectURL(r)}catch(e){o.srcObject=r}o.play(),f.requestTimeout(function e(){e.count=e.count||0,!0===k.loadedData?(k.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}),k.loadedData=!1):(e.count+=1)>10?k.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}):e()},0)},startStreaming:function(e){var r=f.isFunction(e.error)?e.error:f.noop,i=f.isFunction(e.streamed)?e.streamed:f.noop,n=f.isFunction(e.completed)?e.completed:f.noop,o=e.crossOrigin,a=e.existingVideo,s=e.lastCameraStream,d=e.options,c=e.webcamVideoElement,l=f.isElement(a)?a:c||t.createElement("video");o&&(l.crossOrigin=d.crossOrigin),l.autoplay=!0,l.loop=!0,l.muted=!0,l.addEventListener("loadeddata",function(){k.loadedData=!0,d.offset&&(l.currentTime=d.offset)}),a?k.stream({videoElement:l,existingVideo:a,completedCallback:n}):s?k.stream({videoElement:l,cameraStream:s,streamedCallback:i,completedCallback:n}):f.getUserMedia({video:!0},function(e){k.stream({videoElement:l,cameraStream:e,streamedCallback:i,completedCallback:n})},r)},startVideoStreaming:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=t.callback,n=t.webcamVideoElement,o=void 0;(t.timeout!==i?t.timeout:0)>0&&(o=f.requestTimeout(function(){k.onStreamingTimeout(r)},1e4)),k.startStreaming({error:function(){r({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(o)},completed:function(){var t=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e({cameraStream:t.cameraStream,videoElement:t.videoElement,videoHeight:t.videoHeight,videoWidth:t.videoWidth})},lastCameraStream:t.lastCameraStream,webcamVideoElement:n,crossOrigin:t.crossOrigin,options:t})},stopVideoStreaming:function(e){var t=(e=f.isObject(e)?e:{}).keepCameraOn,r=e.videoElement,i=e.webcamVideoElement,n=e.cameraStream||{},o=n.getTracks&&n.getTracks()||[],a=o[0];!t&&!!o.length&&f.isFunction(a.stop)&&a.stop(),f.isElement(r)&&!i&&(r.pause(),f.isFunction(f.URL.revokeObjectURL)&&!f.webWorkerError&&r.src&&f.URL.revokeObjectURL(r.src),f.removeElement(r))}},F={utils:g,error:p,defaultOptions:w,createGIF:m,takeSnapShot:function(e,t){if(t=f.isFunction(e)?e:t,e=f.isObject(e)?e:{},f.isFunction(t)){var r=f.mergeOptions(b,e);m(f.mergeOptions(r,{interval:.1,numFrames:1,gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),t)}},stopVideoStreaming:d,isSupported:function(){return h.isValid()},isWebCamGIFSupported:n,isExistingVideoGIFSupported:function(e){var t=!1;if(f.isArray(e)&&e.length){if(f.each(e,function(e,r){f.isSupported.videoCodecs[r]&&(t=!0)}),!t)return!1}else if(f.isString(e)&&e.length&&!f.isSupported.videoCodecs[e])return!1;return h.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){return h.isValid({getUserMedia:!0})},VERSION:"0.4.5"};"function"==typeof define&&define.amd?define([],function(){return F}):"undefined"!=typeof exports?module.exports=F:e.gifshot=F}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{});